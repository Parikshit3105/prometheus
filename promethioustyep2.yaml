global:
  scrape_interval: 15s
rule_files:
  - alert.rules.yml
  - docker.rules.yml
    # - node.alert.yml
    #  - warningalert.rules.yml
  - api.alert.rules.yml
  - cadvisor.alert.yml
  - redis.alertrule.yml
  - elasticsearch.alert.yml
  - cassandra.alertrules.yml
  - consul.alertrules.yml
  - rabbitmq.alertrules.yml

alerting:
  alertmanagers:
  - static_configs:
    - targets:
      - localhost:9093
scrape_configs:
  - job_name: 'prometheus'
    scrape_interval: 1m
    static_configs:
      - targets: ['localhost:9090']

  - job_name: 'node_exporter'
    scrape_interval: 1m
    static_configs:
      - targets: ['localhost:9100']

  - job_name: 'alertmanager'
    static_configs:
      - targets: ['localhost:9093']

  - job_name: 'monitoring-api'
    metrics_path: /probe
    params:
      module: [http_2xx, http_2xx_auth]
    static_configs:
      - targets:
        - https://abc.com
      



    relabel_configs:
      - source_labels: [__address__]
        target_label: __param_target
      - source_labels: [__param_target]
        target_label: instance
      - target_label: __address__
        replacement: localhost:9115

  - job_name: 'Monitoring-server'
    ec2_sd_configs:
    - region: eu-west-1
      port: 9100
    relabel_configs:
    - source_labels: [__meta_ec2_tag_PrometheusEnabled]
      regex: True
      action: keep
    - source_labels: [__meta_ec2_tag_Name,__meta_ec2_private_ip]
      target_label: instance

  - job_name: 'RabbitMQ'
    ec2_sd_configs:
      - region: eu-west-1
        port: 9419
    relabel_configs:
      - source_labels: [__meta_ec2_tag_PrometheusEnabledRabbitmq]
        regex: True
        action: keep
      - source_labels: [__meta_ec2_tag_Name, __meta_ec2_private_ip]
        target_label: instance

  - job_name: 'elasticsearch'
    metrics_path: "/metrics"
    ec2_sd_configs:
      - region: eu-west-1
        port: 9114
    relabel_configs:
      - source_labels: [__meta_ec2_tag_PrometheusEnabledElasticSearch]
        regex: True
        action: keep
      - source_labels: [__meta_ec2_tag_Name, __meta_ec2_private_ip]
        target_label: instance

  - job_name: 'consul'
    ec2_sd_configs:
      - region: eu-west-1
        port: 9107
    relabel_configs:
      - source_labels: [__meta_ec2_tag_PrometheusEnabledConsul]
        regex: True
        action: keep
      - source_labels: [__meta_ec2_tag_Name, __meta_ec2_private_ip]
        target_label: instance
  - job_name: 'Cassandra-Monitoring'
    scrape_interval: 1m
    scrape_timeout: 40s
    ec2_sd_configs:
      - region: eu-west-1
        port: 8070
    relabel_configs:
      - source_labels: [__meta_ec2_tag_PrometheusEnabledCassandra]
        regex: True
        action: keep
      - source_labels: [__meta_ec2_tag_Name, __meta_ec2_private_ip]
        target_label: instance

  - job_name: 'Webapplaction docker'
    ec2_sd_configs:
      - region: eu-west-1
        port: 28080
    relabel_configs:
      - source_labels: [__meta_ec2_tag_PrometheusEnabledDocker]
        regex: True
        action: keep
      - source_labels: [__meta_ec2_tag_Name, __meta_ec2_private_ip]
        target_label: instance

  - job_name: 'Redis'
    ec2_sd_configs:
      - region: eu-west-1
        port: 9121
    relabel_configs:
      - source_labels: [__meta_ec2_tag_PrometheusEnabledredis]
        regex: True
        action: keep
      - source_labels: [__meta_ec2_tag_Name, __meta_ec2_private_ip]
        target_label: instance